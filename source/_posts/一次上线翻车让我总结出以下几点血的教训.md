---
title: 一次上线翻车让我总结出以下几点血的教训
date: 2021-08-31 09:21:07
tags:
---


从17点准备上线，直到1点最终上线成功，整整耗费8个小时。通过这次上线翻车，总结了以下几点血的教训。

## 基础设施差
导致上线失败的有两点，但是真的是很基础的东西。

### 环境配置混乱
客户端在做渠道环境配置时混乱，基础网络能力采用了一个动态域名配置项，某一个业务模块又采用了另一个动态域名配置项。在研发过程中始终使用测试环境域名，没有按照配置项来去正确引用域名。等到版本发布后才发现引用域名错误，慌慌张张修改配置，战战兢兢回想是否还存在其他配置项。

这个低级错误完全可以避免：

<!--more-->

> 1. 项目最开始就需要定义好环境配置，避免后期研发还需要自己去随意定义环境配置。
> 2. 研发实现过程中不要随意留尾巴，按照项目中公共配置去新增逻辑
> 3. 合理组织 `code review`，及时发现低级错误。

### 后台环境准备不足

我认为的后台环境至少需要准备4个：
> 1. 开发：用于后台研发开发时使用
> 2. 测试：用于客户端开发时使用
> 3. 准上线：用户客户端测试时使用
> 4. 线上：用户线上用户使用

而项目中仅仅只有2个环境，开发和线上。在上线之前，测试仅仅在开发环境上验证过，这样很难测试充分，尤其是一些数据导致的错误。而准上线环境最重要的一点就是，尽量保证和线上环境数据一致。

## 测试验证验证不足

刚刚提到，测试在上线前竟然只在开发环境验证，这就是严重的验证不充分。

另一点，测试之前一直使用 `debug` 版本测试，从未使用 `release` 版本测试。众所周知，`debug` 和 `release` 有着很大的区别，甚至有些测试称 `debug` 包为 `野包（手动狗头）`。翻车是迟早的事情（我竟然有点幸灾乐祸）。

## 上线工作准备不充分

18点的时候，竟然还在重新申请一个第三方库的 `appId` 去临时替换，当时我就预感要翻车。果然还是没能逃过一劫，来来回回弄了个把小时，还是回退到之前测试稳定的 `appId`。

开始验证的时候发现，资源下载太慢，`5G` 的资源，下载需要个把小时，项目和产品开始疯狂吐槽，一致决定资源暂时不上线。又是一通研发修改、测试验证。

嗯，这很敏捷。

{% img /images/blog/猿创日记/210831/蓝天白云.jpeg %}

<p align="right">盗图自朋友圈 @Q694263030</p>